<!-- -->
<DOCTYPE HTML>
<html id="mainhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>処理パターン(５) C言語で作成した外部サブプログラム呼ぶ</title>
  <link rel="stylesheet" type="text/css" href="/lib/document.css">
</head>
<body id="mainbody">
<!-- ↓↓↓↓↓↓↓↓↓↓↓ -->
<script type="text/javascript" src="/lib/funcs5.js"></script>
<!-- ↑↑↑↑↑↑↑↑↑↑ -->
<div id="content">
<h2 class="lm70 tm20 bm0">
処理パターン(５) 
</h2>
<h2 class="lm70 tm0 bm0">
C言語で作成した外部サブプログラム呼ぶ
</h2>
<div class="lm70 tm10 rm50">
『処理パターン(４) 外部サブプログラム呼ぶ』のサブプログラムをC言語で作成してみる。
</div>
<h3 class="lm70 tm20 bm0 rm60">
入出力構成図
</h3>
<div class="lm70 tm5 rm60">
呼び出すCOBOLプログラムのインタフェースに変更はない。
</div>
<!-- 画像 -->
<a href="/lib/HTMLofImage.html?filename=/cobol/6/cob06_01.png&title=cob06_01&width=500" target="_new">
<img class="lm70 tm10 bm0" src="cob06_01.png" alt="[cob06_01.png]" width="300"></a>
<h3 class="lm70 tm20 bm0 rm60">
ソースコード
</h3>
<!--ソースコードリンク-->
<div class="lm70 tm5 bm0 rm60">
<h4 class="inline">
メインプログラム&nbsp;
</h4>
<a href="/lib/HTMLofText.html?filename=/cobol/6/source/MAIN01.txt&title=MAIN01.cbl" target="_new">MAIN01.cbl</a>
</div>
<div class="lm70 tm5 rm60">
顧客マスタテーブルの有効件数を数値項目（COMP-X）として定義する。これを引数にして Cプログラムに渡すと、数値項目の桁数によりC側での整数の大きさ（1バイト、2バイト、4バイト、8バイト）が自動的に決まる。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/cobol/6/MAIN01_1.txt" width="580" height="250"></iframe>
<!--ソースコードリンク-->
<div class="lm70 tm30 bm0 rm60">
<h3 class="inline">
サブプログラム&nbsp;
</h3>
<a href="/lib/HTMLofText.html?filename=/cobol/6/source/sublib.txt&indent=20" target="_new">sublib.c</a>
</div>
<h3 class="lm70 tm5 bm0 rm60">
なぜかエンディアンの変換が必要
</h3>
<div class="lm70 tm0 rm60">
COBOL側はBig Endianだが、C言語側はLittle Endianになっている。引数の数値項目を整数値（COMP-X）とした場合、受け渡しのつどエンディアンの変換を行う必要がある。
</div>
<div class="lm70 tm10 rm60">
エンディアンの変更は、単純なバイトスワップで良い。GNU Cライブラリに byteswap.hにマクロが定義されているのだが、OSXのライブラリにはなぜかないので、自身で実装している。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/cobol/6/sublib_1.txt" width="580" height="320"></iframe>
<h3 class="lm70 tm30 bm0 rm60">
コンパイル/リンクの方法
</h3>
<h3 class="lm70 tm5 bm0 rm60">
静的リンク
</h3>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/cobol/6/cobc01.txt" width="580" height="160"></iframe>
<h3 class="lm70 tm20 bm0 rm60">
動的（ダイナミック）リンク
</h3>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/cobol/6/cobc02.txt" width="580" height="230"></iframe>
<!-- 空白行 -->
<div class="bp40"></div>
<!----------------------------------------------->
</div><!-- end of content -->
<footer id="mainfooter">
<div class="tp10 bm10 bp10 textright"> <span class="rm500 font80"><a href="/lib/index5.html">メニューに戻る</a></span><span class="rm20 font80"><a href="#mainheader">TOPに戻る</a></span></div>
</footer>
<script type="text/javascript" src="/lib/access/access2.js"></script>
</body>
</html>
