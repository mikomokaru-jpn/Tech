       IDENTIFICATION             DIVISION.       PROGRAM-ID.                SUM001.       ENVIRONMENT                DIVISION.       INPUT-OUTPUT               SECTION.       FILE-CONTROL.      *入力ファイル 行順編成ファイル(テキストファイル)         SELECT  F1  ASSIGN  TO  "/Users/itohisao/Desktop/COBOL/F001.txt"       ORGANIZATION IS LINE SEQUENTIAL       ACCESS  MODE  IS  SEQUENTIAL  STATUS FST1.        *出力ファイル 行順編成ファイル(テキストファイル)         SELECT  F2  ASSIGN  TO  "/Users/itohisao/Desktop/COBOL/F002.txt"       ORGANIZATION IS LINE SEQUENTIAL       ACCESS  MODE  IS  SEQUENTIAL  STATUS FST2.                DATA                     DIVISION.       FILE                     SECTION.      * 入力ファイル       FD  F1.       01  F1R.           05  YMD.                          10  YYYY            PIC 9(04).                10  MM              PIC 9(02).                10  DD              PIC 9(02).            05  SALES               PIC 9(10).      * 出力ファイル       FD  F2.       01  F2R                     PIC X(18).              WORKING-STORAGE         SECTION.       01  END-FLG                 PIC 9(01).       01  FST1                    PIC X(02).       01  FST2                    PIC X(02).      *保存キー       01  SAVE-KEY.                      05  YYYY                PIC 9(4).                     05  MM                  PIC 9(2).            05  DD                  PIC 9(2).       * 出力レコード                             01  SUB-TOTAL-RECORD.           05  YMD.                          10  YYYY            PIC 9(4).                10  MM              PIC 9(2).                10  MM-R            REDEFINES MM.                   15 MM-CHAR      PIC X(02).                10  DD              PIC 9(2).                10  DD-R            REDEFINES DD.                   15 DD-CHAR      PIC X(02).            05  SALES               PIC ZZZZZZZZZ9.      * 合計                                    01  TOTAL                   PIC 9(10).      * 日次計       01  SUB-TOTAL-DAY           PIC 9(10).      * 月次計       01  SUB-TOTAL-MONTH         PIC 9(10).       PROCEDURE                DIVISION.      ******************************************************************      * 主処理       ******************************************************************        PERFORM INIT-RTN       PERFORM LOOP-RTN UNTIL END-FLG NOT = 0       PERFORM END-RTN       STOP RUN.      ******************************************************************      * 前処理       ******************************************************************       INIT-RTN.      *    初期化           MOVE 0 TO END-FLG           OPEN INPUT F1           OPEN OUTPUT F2           INITIALIZE TOTAL SUB-TOTAL-DAY SUB-TOTAL-MONTH      *    1件目のレコードの入力           PERFORM READ-RTN      *    キーの保存           MOVE YMD OF F1R TO SAVE-KEY.       INIT-RTN-EX.            EXIT.      ******************************************************************      * 繰り返し処理       ******************************************************************       LOOP-RTN.      * 次のレコード・キーの比較              IF YMD OF F1R NOT = SAVE-KEY THEN      *        キーブレーク・日次計出力               PERFORM WRITE-DAY-RTN               IF YYYY OF F1R NOT = YYYY OF SAVE-KEY OR                  MM OF F1R NOT = MM OF SAVE-KEY THEN      *            キーブレーク・月次計出力                   PERFORM WRITE-MONTH-RTN               END-IF         *        キーの保存               MOVE YMD OF F1R TO SAVE-KEY              END-IF      *    金額の加算           ADD SALES OF F1R TO SUB-TOTAL-DAY SUB-TOTAL-MONTH TOTAL       *    レコードの入力           PERFORM READ-RTN.       LOOP-RTN-EX.            EXIT.      ******************************************************************      * 後処理       ******************************************************************       END-RTN.      *    日次計出力           PERFORM WRITE-DAY-RTN      *    月次計出力           PERFORM WRITE-MONTH-RTN      *    合計出力                MOVE YYYY OF SAVE-KEY TO YYYY OF SUB-TOTAL-RECORD           MOVE "  " TO MM-CHAR OF SUB-TOTAL-RECORD           MOVE "  " TO DD-CHAR OF SUB-TOTAL-RECORD           MOVE TOTAL TO SALES OF SUB-TOTAL-RECORD            WRITE F2R FROM SUB-TOTAL-RECORD      *    ファイルクローズ　           CLOSE  F1 F2.       END-RTN-EX.           EXIT.      ******************************************************************      * 入力処理        ******************************************************************       READ-RTN.           READ  F1                AT END                   ADD 1 TO END-FLG                   MOVE HIGH-VALUE TO YMD OF F1R           END-READ.       READ-RTN-EX.           EXIT.      ******************************************************************      * 日次出力処理        ******************************************************************       WRITE-DAY-RTN.      *    出力レコードの編集            INITIALIZE SUB-TOTAL-RECORD                MOVE SAVE-KEY TO YMD OF SUB-TOTAL-RECORD           MOVE SUB-TOTAL-DAY TO SALES OF SUB-TOTAL-RECORD        *    ファイル出力                WRITE F2R FROM SUB-TOTAL-RECORD      *    集計エリアのクリア                INITIALIZE SUB-TOTAL-DAY.       WRITE-DAY-RTN-EX.           EXIT.      ******************************************************************      * 月次出力処理        ******************************************************************       WRITE-MONTH-RTN.      *    出力レコードの編集            INITIALIZE SUB-TOTAL-RECORD                MOVE YYYY OF SAVE-KEY TO YYYY OF SUB-TOTAL-RECORD           MOVE MM OF SAVE-KEY TO MM OF SUB-TOTAL-RECORD           MOVE "  " TO DD-CHAR OF SUB-TOTAL-RECORD           MOVE SUB-TOTAL-MONTH TO SALES OF SUB-TOTAL-RECORD       *    ファイル出力                WRITE F2R FROM SUB-TOTAL-RECORD      *    集計エリアのクリア                INITIALIZE SUB-TOTAL-MONTH.       WRITE-MONTH-RTN-EX.           EXIT.