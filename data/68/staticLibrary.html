<!--  -->
<DOCTYPE HTML>
<html id="mainhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Static Libraryを作成する</title>
	<link rel="stylesheet" type="text/css" href="/lib/document.css">
</head>
<body id="mainbody">
<!-- ↓↓↓↓↓↓↓↓↓↓↓ -->
<script type="text/javascript" src="/lib/funcs1.js"></script>
<!-- ↑↑↑↑↑↑↑↑↑↑ -->
<div id="content">
<h2 class="lm70 tm20 bm0">Static Libraryを作成する</h2>
<div class="lm70 tm10 rm60">
Static（静的）なライブラリは、アプリケーションのビルド時にライブラリオブジェクトを取りみリンクするもの。 
</div>
<div class="lm70 tm10 rm60">
ライブラリに含めることができるのは（当たり前だが）プログラムコードから作成されたオブジェクトのみ。一方、Frameworkを利用すれば、リソースを含めたバンドルとして提供できるので、こちらの方が使い道はありそう。（別途紹介予定）
</div>
<h3 class="lm70 tm30 bm0 rm60">
ライブラリ作成の手順
</h3>
<div class="lm70 tm0" style="width:550px; border-top:solid 1px #909090;"></div>
<h3 class="lm70 tm20 bm0 rm60">
プロジェクトを作成する
</h3>
<div class="lm70 tm5 rm60">
プロジェクトの種類は『Libray』、Typeは『Static』を選ぶ。例題のプロジェクトの名前は『SimpleDate』とした。
</div>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library06.png&title=static_library06&width=700" target="_new">
<img class="lm70 tm5 bm5" src="static_library06.png" alt="[static_library06]" width="300"></a>
<h3 class="lm70 tm10 bm0 rm60">
クラスを作成する
</h3>
<div class="lm70 tm5 rm60">
テストのための簡単な機能として、NSDateクラスをラップしたクラスを作成し、当日日付を属性付き文字列として返すインスタンス・メソッドを実装する。引数にフォントサイズを指定する。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/data/68/UADateUtil.txt" width="580" height="380"></iframe>
<div class="lm70 tm20 rm60">
このクラスは NSAttributedStringクラスをラップしたクラスを所有する。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/data/68/UAStringUtil.txt" width="580" height="330"></iframe>
<h3 class="lm70 tm30 bm0 rm60">
ライブラリを格納するディレクトリを決める
</h3>
<div class="lm70 tm5 rm60">
ライブラリを利用する側からすると、関連するファイルを参照するときに、ライブラリを作成したプロジェクトのパス名に依存していたのでは不都合である。ヘッダファイルとライブラリのオブジェクトは特定の場所にあることが望ましい。
</div>
<div class="lm70 tm10 rm60">
Build Phases の設定により、特定のファイルをビルドを実行するたびに、指定のフォルダに出力することができる。ここでは、ホームディレクトリの下に下記のフォルダを作成し、"ibclude" にヘッダファイル、"lib" にオブジェクトファイルを出力することにする。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/data/68/dir1.txt" width="580" height="60"></iframe>
<h3 class="lm70 tm20 bm0 rm60">
ビルドの設定を行う
</h3>
<div class="lm70 tm5 rm60">
ビルドのTARGETを選び Build Phasesタブを開き、左上の追加ボタン（＋）をクリックするとメニューが現れるので "New Copy Files Phase" を選ぶ。
</div>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library01.png&title=static_library01&width=800" target="_new">
<img class="lm70 tm0 bm5" src="static_library01.png" alt="[static_library01]" width="500"></a>

<div class="lm70 tm15 rm60">
ファイルコピーの設定フォームが現れるので、まず出力先のディレクトリを入力する。パスの指定は絶対パス（Absolute Path）を選ぶ。そのあと下の追加ボタン（＋）をクリックする。
</div>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library02.png&title=static_library02&width=800" target="_new">
<img class="lm70 tm0 bm5" src="static_library02.png" alt="[static_library02]" width="500"></a>
<div class="lm70 tm15 rm60">
Finder形式のパネルが現れるので、出力するファイルを選択し、Addボタンで追加する。
</div>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library03.png&title=static_library03&width=800" target="_new">
<img class="lm70 tm0 bm5" src="static_library03.png" alt="[static_library03]" width="500"></a>
<div class="lm70 tm15 rm60">
設定が完了すると次のような画面になる。
</div>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library04.png&title=static_library04&width=800" target="_new">
<img class="lm70 tm0 bm5" src="static_library04.png" alt="[static_library04]" width="500"></a>
<div class="lm70 tm15 rm60">
ヘッダファイルの出力の設定と同じ手順で、オブジェクトファイルの設定を行う。画面の左上の追加ボタン（＋）のクリックから繰り返す。
</div>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library05.png&title=static_library05&width=800" target="_new">
<img class="lm70 tm0 bm5" src="static_library05.png" alt="[static_library05]" width="500"></a>
<h3 class="lm70 tm20 bm0 rm60">
ビルドを実行する
</h3>
<div class="lm70 tm5 rm60">
以上の設定の後ビルドを行うと、ヘッダファイルとライブラリのオブジェクトファイルが出力先のフォルダに出力されている。オブジェクトファイル名は、プロジェクト名の頭に "lib" を付けたものになる、
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/data/68/dir2.txt" width="580" height="60"></iframe>
<h3 class="lm70 tm30 bm0 rm60">
ライブラリを利用する
</h3>
<div class="lm70 tm0" style="width:550px; border-top:solid 1px #909090;"></div>
<h3 class="lm70 tm20 bm0 rm60">
アプリケーション用のプロジェクトを作成する
</h3>
<div class="lm70 tm5 rm60">
Build Serrings で、ヘッダファイルの参照先のパス、リンクするオブジェクトの参照先パスを指定する。パスにはライブラリ作成時に決めたディレクトリを指定する。
</div>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library07.png&title=static_library07&width=800" target="_new">
<img class="lm70 tm10 bm5" src="static_library07.png" alt="[static_library07]" width="500"></a>
<h3 class="lm70 tm20 bm0 rm60">
ビルドの設定を行う
</h3>
<div class="lm70 tm5 rm60">
Build Phases で、リンクするオブジェクトファイル名を指定する。（*1）
</div>
<div class="lm70 tm0 rm60">
この設定により、ビルド実行時にリンクオブジェクトが実際に取り込まれる。
</div>
<div class="lm70 tm10 rm60">
Build Phasesタブの Link Binary With Liblaries 入力フォームを開き、下にあるの追加ボタン（＋）をクリックする。
</div>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library08.png&title=static_library08&width=800" target="_new">
<img class="lm70 tm5 bm5" src="static_library08.png" alt="[static_library08]" width="500"></a>
<div class="lm70 tm10 rm60">
システム提供のライブラリ一覧が表示されるので、Add Other...をクリックし オープンパネルを表示する。所定のディレクトリを開いてオブジェクトファイルを指定しOpenボタンをクリックする。
</div>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library09.png&title=static_library09&width=800" target="_new">
<img class="lm70 tm5 bm5" src="static_library09.png" alt="[static_library09]" width="500"></a>

<div class="lm120 tm10 rm60">
（*1）プロジェクトナビゲータのAdd Files によりオブジェクトファイルをプロジェクトに取り込んでも同じである。なお、Copy ItemsをNOにして元のファイルを参照しないと、ファイルの更新と同期が取れなくなるので注意せよ。
</div>
<h3 class="lm70 tm20 bm0 rm60">
アプリケーションプログラムの実装
</h3>
<div class="lm70 tm5 rm60">
ライブラリをインクルードしたアプリケーションプログラムを作成する。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/data/68/AppDelegate.txt" width="580" height="330"></iframe>
<div class="lm70 tm10 rm60">
ヘッダファイルをインポートすることでクラスが可視となり、コンパイルが通る。変数名の補完もサポートされる。（ただし#Import のファイル名だけは補完してくれない）
</div>
<h3 class="lm70 tm20 bm0 rm60">
実行結果
</h3>
<!-- 画像 -->                            
<a href="/lib/HTMLofImage.html?filename=/data/68/static_library11.png&title=static_library11&width=600" target="_new">
<img class="lm70 tm0 bm5" src="static_library11.png" alt="[static_library11]" width="250"></a>

<h4 class="lm70 tm20 bm0 rm60">
ライブラリの開発・評価の方法
</h4>
<div class="lm70 tm0" style="width:550px; border-top:solid 1px #909090;"></div>
<div class="lm70 tm5 rm60">
一般的には、最初のステップで、アプリケーションプロジェクトを作成し、ライブラリとする予定のクラスを組み込んだアプリケーションを開発し評価を行う。
</div>
<div class="lm70 tm10 rm60">次に、ライブラリプロジェクトを作成し、アプリケーションライブラリから、ライブラリとする部分のクラスだけをそこに移行し、オブジェクトをビルドする。作成されたライブラリオブジェクトが他のアプリケーションから利用可能となる。
</div>
<div class="lm70 tm10 rm60">
アプリケーションプロジェクトからクラスを抜き出すのが手作業で非常に面倒だ。ライブラリプロジェクトの中だけで、開発・評価を一貫して行えないものか？ Workspaceを使えないか？
</div>
<div class="bm40"></div>
</div><!-- end of content -->
<!-- ↓↓↓↓↓↓↓↓↓↓↓ -->
<footer id="mainfooter">
<div class="tp10 bm10 bp10 textright"> <span class="rm500 font80"><a href="/lib/index1.html">メニューに戻る</a></span><span class="rm20 font80"><a href="#mainheader">TOPに戻る</a></span></div>
</footer>
<!-- ↑↑↑↑↑↑↑↑↑↑ -->
<script type="text/javascript" src="/lib/access/access2.js"></script>
</body>
</html>
<!--
http://localhost/50_test/upload.html
-->
