<DOCTYPE HTML>
<html id="mainhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>ディレクトリをトラバースしてファイル情報を得る</title>
	<link rel="stylesheet" type="text/css" href="/lib/document.css">
</head>
<body id="mainbody">
<!-- ↓↓↓↓↓↓↓↓↓↓↓ -->
<script type="text/javascript" src="/lib/funcs1.js"></script>
<!-- ↑↑↑↑↑↑↑↑↑↑ -->
<div id="content">
<!----------------------------------------------->
<h2 class="lm70 tm20 bm10">ディレクトリをトラバースしてファイル情報を得る</h2>
<div class="lm70 tm10 rm60 bm0">
特定のディレクトリ下のファイル情報をサブディレクトリも含めて取得する。 
</div>
<!-- div class="lm70 tm0" style="width:550px; border-top:solid 1px #909090;"></div -->
<div class="lm70 tm10 rm60">
ディレクトリは階層構造であり、その深さは任意である。特定のディレクトリの下にあるファイルの情報を、サブディレクトリも含めて全て取得するには、関数の再帰呼び出し（リカーシブコール）を利用する。このようにディレクトリ構造を再帰的に追い求めることをトラバースするということがある。
</div>
<h3 class="lm70 tm20 bm0 rm60">
ファイルパス名の取得
</h3>
<div class="lm70 tm5 rm60">
以下のC関数は、特定のディレクトリの下の全ファイルのフルパス名をNSArrayオブジェクトの配列にして返すものである。 なお、ディレクトリの操作のためにCライブラリ&lt;sys/dirent.h&gt;をインクルードする。
</div>
<!--ソースコード-->
<iframe class="lm70 tm10" src="/lib/HTMLofText.html?filename=/data/87/traverse.txt" width="580" height="610"></iframe>
<div class="lm70 tm10 rm60">
ディレクトリ名を引数に取り、そのディレクトリの下にあるファイルのパス名を取得する。ディレクトリの下にサブディレクトリがあればそのサブディレクトリを引数にして自分自身を再び呼び出しパス名を取得する処理を繰り返す。ディレクトリの深さだけ関数が再帰的に呼び出される。
</div>
<div class="lm70 tm10 rm60">
関数 traverse は、Objective-Cの実装ファイル（.m）に記述すれば、Foundationフレームワークの中で動くので、Objective-Cのクラスを使用することができる。
</div>
<div class="lm70 tm10 rm60">
Swift版 実行例
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/data/87/output.txt" width="580" height="430"></iframe>
<div class="lm110 tm5 bm0 rm60">
<a href='/data/B39/objc_call.html' target="_blank">SwiftからObjective-Cの処理（.m）を呼び出すにはこちらの操作が必要</a>
</div>

<div class="lm70 tm20 bm0 rm60">
[参考]ファイル情報を取得する&lt;sys/stat.h&gt;
</div>
<div class="lm70 tm5 rm60">
本例では使用していないが、Cライブラリを利用すればinode関連のファイル情報を得ることができる。
次の例はファイルサイズを求めている。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/data/87/stat.txt" width="580" height="150"></iframe>
<h3 class="lm70 tm20 bm0 rm60">
ファイルタイプの判定
</h3>
<div class="lm70 tm0 rm60">
たとえば、テキストファイルを読み込みキーワードによる全文検索を行うといった、特定のタイプのファイルに対して特定の操作を行うときには、取得したファイルパス名からファイルのタイプを判定することが求められる。
</div>
<div class="lm70 tm10 rm60">
ファイルタイプは、ファイルのパス名またはURLから取得できる Uniform Type Identifier（UTI）から求めることができる。
ファイルタイプを判定するには、UTTypeConformsTo関数を使用する。
</div>
<div class="lm70 tm10 rm60">
Objective-C版
</div>
<!--ソースコード-->
<iframe class="lm70 tm0" src="/lib/HTMLofText.html?filename=/data/87/UTTypeConformsTo.txt" width="580" height="130"></iframe>
<div class="lm70 tm10 rm60">
Swift版
</div>
<!--ソースコード-->
<iframe class="lm70 tm0" src="/lib/HTMLofText.html?filename=/data/87/UTTypeConformsTo2.txt" width="580" height="150"></iframe>
<h4 class="lm70 tm20 rm60 bm0">
判定の仕組みがよくわからない
</h4>
<div class="lm70 tm5 rm60">
拡張子.txtのを持つテキストファイルから拡張子を削ってもテキストファイルとして認識される。ただし拡張子を.jpgに変えると認識されなくなる。そして.jpgを削るとまたテキストファイルとして認識される。ファイル本体や名前とは別にファイルタイプを保持しているところ（たぶんinodeのような）があり、リネームタイミングで更新しているのだろう。
</div>
<!----------------------------------------------->
<div class="bm40"></div>
</div><!-- end of content -->
<!-- ↓↓↓↓↓↓↓↓↓↓↓ -->
<footer id="mainfooter">
<div class="tp10 bm10 bp10 textright"> <span class="rm500 font80"><a href="/lib/index1.html">メニューに戻る</a></span><span class="rm20 font80"><a href="#mainheader">TOPに戻る</a></span></div>
</footer>
<!-- ↑↑↑↑↑↑↑↑↑↑ -->
<script type="text/javascript" src="/lib/access/access2.js"></script>
</body>
</html>
