<!-- 
85 MyHealthCalendar
-->
<DOCTYPE HTML>
<html id="mainhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>データの照会と更新（PHP/SQL）</title>
	<link rel="stylesheet" type="text/css" href="/lib/document.css">
</head>
<body id="mainbody">
<!-- ↓↓↓↓↓↓↓↓↓↓↓ -->
<script type="text/javascript" src="/lib/funcs1.js"></script>
<!-- ↑↑↑↑↑↑↑↑↑↑ -->
<div id="content">
<!----------------------------------------------->
<h2 class="lm70 tm20 bm10">データの照会と更新（PHP/SQL）</h2>
<div class="lm70 tm10 rm60">
Objective-CアプリケーションからMySQLデータベースに対して、データの読み書きを行う方法について「血圧管理カレンダー」を例に説明する。
</div>
<div class="lm70 tm10 rm60">
本章では、サーバーサイドの処理として、PHPスクリプトによりSQLコマンドを実行し、データの照会・更新する手順について説明する。
</div>
<div class="lm70 tm10 rm60">
サーバーとのやり取りは、HTTPのPOSTコマンドインタフェースとし、リクエストパラメータは x-www-form-urlencoded 形式、レスポンスデータはJSON形式とする。
</div>
<h3 class="lm70 tm20 rm60 bm0">
MySQLデータベースの定義
</h3>
<div class="lm70 tm0 rm60">
データベース名：health 
</div>
<div class="lm70 tm0 rm60">
テーブル名：blood_pressure（血圧データ）
</div>
<!--ソースコード-->
<iframe class="lm70 tm5 bm10" src="/lib/HTMLofText.html?filename=/html/3/source/blood_pressure_table.txt" width="580" height="180"></iframe>
<h3 class="lm70 tm10 rm60 bm0">
PHPスクリプト
</h3>
<h3 class="lm70 tm5 rm60 bm0">
(1) 言語の設定（init.php）
</h3>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/3/source/init.txt" width="580" height="130"></iframe>
<h3 class="lm70 tm10 rm60 bm0">
(2) データベースと接続する（MYDB.php）
</h3>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/3/source/MYDB.txt" width="580" height="350"></iframe>
<div class="lm70 tm10 rm60">
データベースを利用するPHPスクリプトは、上記２ファイルをインクルードし、起動するごとにデータベースと接続する関数（db_connect）を呼び出す。
</div>
<h3 class="lm70 tm15 rm60 bm0">
(3) データの照会
</h3>
<div class="lm70 tm0 rm60">
指定した日付の範囲の血圧レコードを読み込む
</div>
<div class="lm70 tm0 rm60">
戻り値はJSON形式のデータにして返却する。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/3/source/sql_r10.txt" width="580" height="380"></iframe>
<h3 class="lm70 tm15 rm60 bm0">
(4) データの更新
</h3>
<div class="lm70 tm0 rm60">
指定の日付の血圧レコードを追加または変更する
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/3/source/sql_w10.txt" width="580" height="1060"></iframe>

<h3 class="lm70 tm30 rm60 bm0">
ブラウザで実行結果を確認する方法
</h3>
<div class="lm70 tm0 rm60">
HTMLフォームからPOSTコマンドを送信し、レスポンスデータをHTMLに編集して表示するようにする。
</div>

<!-- 画像 -->
<a href="/lib/HTMLofImage.html?filename=/data/A13/16_db_update.png&title=POST&width=700" target="_new">
<img class="lm70 tm10 bm0 bp0" src="16_db_update.png" width="500" align="top" alt="POST" ></a>

<div class="lm70 tm0 rm60">
HTMLソース
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/3/source/post_r10.txt" width="580" height="380"></iframe>
<div class="lm70 tm10 rm60">
PHPスクリプトを次のように修正する。POSTパラメータの有無で処理を制御するので、本番の動作に影響ない。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/3/source/sql_r10_test.txt" width="580" height="710"></iframe>
<!----------------------------------------------->
<div class="bm40"></div>
</div><!-- end of content -->
<!-- ↓↓↓↓↓↓↓↓↓↓↓ -->
<footer id="mainfooter">
<div class="tp10 bm10 bp10 textright"> 
<span class="rm500 font80"><a href="/lib/index4.html">メニューに戻る</a></span>
<span class="rm20 font80"><a href="#mainheader">TOPに戻る</a></span>
</div> 
</footer>
<!-- ↑↑↑↑↑↑↑↑↑↑ -->
<script type="text/javascript" src="/lib/access/access2.js"></script>
</body>
</html>






