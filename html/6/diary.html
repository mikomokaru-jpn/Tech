<!-- 
-->
<DOCTYPE HTML>
<html id="mainhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>日記帳（JavaScript版）</title>
	<link rel="stylesheet" type="text/css" href="/lib/document.css">
</head>
<body id="mainbody">
<!-- ↓↓↓↓↓↓↓↓↓↓↓ -->
<script type="text/javascript" src="/lib/funcs4.js"></script>
<!-- ↑↑↑↑↑↑↑↑↑↑ -->
<div id="content">
<h2 class="lm70 tm20 bm10">日記帳（JavaScript版）</h2>
<!------ h2 ------>
<h2 class="lm70 tm10 bm0 rm60">
テキスト入力
</h2>
<div class="lm70 tm5 rm60">
日付に対応した入力フォームを開き、テキストを入力することができる。入力がある日はカレンダーの日付の背景色が変わる。
</div>
<div class="lm70 tm10 rm60">
入力領域を削除または空白文字で埋めて更新した場合、データを削除し、カレンダー上も未入力の状態になる。
</div>
<!-- 画像 -->
<a href="/lib/HTMLofVideo.html?filename=/html/6/diary1.mp4&title=日記帳&width=700" target="_new">
<img class="lm70 tm0 bm0" src="diary1.png" alt="[diary1]" width="600"></a>
<div class="lm200 tm0 rm60">
画像をクリックすると動画が表示されます
</div>
<!------ h2 ------>
<h2 class="lm70 tm30 bm0 rm60">
キーワードによる日記帳の検索
</h2>
<div class="lm70 tm5 rm60">
キーワードによる全文検索を行い、一致したワードがある日のテキストを日付ごとに表示する。キーワードはハイライト表示する。キーワードは複数指定を可とし、OR条件、AND条件に対応する。検索の期間の範囲を指定することができる。
</div>
<div class="lm70 tm10 rm60">
テキストの表示エリアをダブルクリックすると、その日付のテキスト入力フォームが開き、編集・更新を行うことができる。
</div>
<!-- 画像 -->
<a href="/lib/HTMLofVideo.html?filename=/html/6/diary2.mp4&title=日記帳&width=700" target="_new">
<img class="lm70 tm10 bm0" src="diary2.png" alt="[diary2]" width="600"></a>
<!-- 画像 -->
<a href="/lib/HTMLofVideo.html?filename=/html/6/diary2.mp4&title=日記帳&width=700" target="_new">
<img class="lm70 tm10 bm0" src="diary3.png" alt="[diary3]" width="600"></a>
<div class="lm200 tm0 rm60">
画像をクリックすると動画が表示されます
</div>
<!------ h ------>
<h2 class="lm70 tm30 bm0 rm60">
技法的なこと
</h2>
<!------ h ------>
<h2 class="lm70 tm5 bm0 rm60">
テキストの入出力
</h2>
<div class="lm70 tm0" style="width:580px; border-top:solid 1px #909090;"></div>
<div class="lm70 tm5 rm60">
ブラウザから入力された日記帳のテキストデータはサーバのデータベースに保存される。日記帳テーブルは、キーの日付とテキスト本文から構成される。
</div>
<div class="lm70 tm10 rm60">
サーバとのデータのやりとりは JavaScriptの実装により XMLHttpRequestオブジェクトを利用したHTTP送受信により実現する。
サーバサイドの処理はPHPスクリプトで実装する。
</div>
<h3 class="lm70 tm10 rm60 bm0">
HTML定義
</h3>
<div class="lm70 tm0 rm60">
&lt;textarea&gt;タグの中にテキストをセットする
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/textio1.txt" width="580" height="280"></iframe>
<h3 class="lm70 tm20 rm60 bm0">
日記帳テキストの取得・JavaScript
</h3>
<div class="lm70 tm0 rm60">
指定した日付の日記帳テキストをサーバから受け取り、HTML文書の &lt;textarea&gt; タグの中に埋め込む。
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/textio2.txt" width="580" height="600"></iframe>
<h3 class="lm70 tm20 rm60 bm0">
データベースの照会・PHP
</h3>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/textio3.txt" width="580" height="350"></iframe>
<!------ h ------>
<h2 class="lm70 tm30 bm0 rm60">
キーワードによるテキスト検索
</h2>
<div class="lm70 tm0" style="width:580px; border-top:solid 1px #909090;"></div>
<div class="lm70 tm5 rm60">
テキストの検索は SQLのLIKE文により行う。キーワードで日記帳テーブルを検索しキーワードにヒットした日付のレコードを取得して返す。
</div>
<h3 class="lm70 tm10 rm60 bm0">
OR検索
</h3>
<div class="lm70 tm0 rm60 bm0">
指定されたキーワードについてそれぞれ検索（SELECT）を行い、重複した日付のレコードはマージする。
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/select1.txt" width="580" height="670"></iframe>
<h3 class="lm70 tm20 rm60 bm0">
AND検索
</h3>
<div class="lm70 tm0 rm60">
指定されたキーワードについてそれぞれ検索（SELECT）を行うが、２回目以降の検索では、それまでにヒットした日付のレコードのみを残すようにする。結果として全ての回の検索でヒットしたレコードだけが残る。
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/select2.txt" width="580" height="840"></iframe>
<!--ソースコードリンク-->
<div class="lm70 tm20 rm60">
（参考） <a href="/lib/HTMLofText.html?filename=/html/6/source/sql.txt&indent=20" target="_new">AND/OR検索を １回のSQL文で実現する方法</a> （ただし、キーワードの数により多段階のSQL文を動的に生成するとなると難しそうだ）
</div>
<!------ h ------>
<h3 class="lm70 tm20 rm60 bm0">
検索したキーワードをハイライト表示する
</h3>
<div class="lm70 tm5 rm60">
検索の結果、JavaScript の Stringオブジェクトのメソッドを使用して、表示テキスト上の全てのキーワードを黄色の背景色で囲む。これらのメソッドは文字列のマッチングに正規表現を利用できる。
</div>
<div class="lm70 tm20 rm60">
キーワドの前後の空白をトリミングする。トリミングは文字列の前後の空白を削除するもので、文字列の中に含まれる空白はそのままである。
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/regex01.txt" width="580" height="40"></iframe>
<div class="lm70 tm20 rm60">
キーワードは複数入力されるので文字列を空白文字を区切り文字として分割し、配列に格納する。トリミングをしておかないと前後に空白があった場合、分割の結果、長さゼロの文字列を抜き出してしまう。
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/regex03.txt" width="580" height="40"></iframe>
<div class="lm70 tm5 rm60">
（参考）サーバのPHPでもキーワードを空白文字で区切って分割する処理を行っている。
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/regex04.txt" width="580" height="40"></iframe>
<div class="lm70 tm20 rm60">
文字列置換により全てのキーワードに対しマッチした文字列の前後に背景色を変える &lt;span&gt;タグを埋め込む。これをHTMLタグとして有効化するにはテキストを innerHTMLプロパティにセットしなくてはいけない。またそうすると改行コードは認識されなくなるので、これを&lt;br&gt;タグに変換する必要もある。
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/regex05.txt" width="580" height="210"></iframe>
<!------ h ------>
<h2 class="lm70 tm20 bm0 rm60">
イベントハンドラ登録についての注意
</h2>
<div class="lm70 tm0" style="width:550px; border-top:solid 1px #909090;"></div>
<div class="lm70 tm5 rm60">
本アプリケーションではカレンダー画面の入力、検索ボタンはテキスト入力画面の表示中はクリックしても無効となるように、画面間の遷移でイベントハンドラの有効化/無効化を行っている。
</div>
<div class="lm70 tm10 rm60">
注意することは、イベントハンドラの登録（addEventListenerメソッド）は実行するごとにハンドラがひとつづつ追加されるので、イベントハンドラの削除（removeEventListenerメソッド）と「対」に行なわなければならない。そうしないとハンドラの登録が累積していき、１回のクリックで同じハンドラが複数回起動することになってしまう。
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/event_listener.txt" width="580" height="60"></iframe>
<div class="lm70 tm10 rm60">
あるいは、ハンドラの実行が一回だけと決まっている場合は、onceオプションを使用することもできる。
</div>
<!-- ソースコード -->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/6/event_listener2.txt" width="580" height="40"></iframe>

<!------ h ------>
<h2 class="lm70 tm20 bm0 rm60">
ソースコード
</h2>
<div class="lm70 tm0" style="width:580px; border-top:solid 1px #909090;"></div>
<!--ソースコードリンク-->
<div class="lm70 tm5 rm60">
HTML
</div>
<div class="lm100 tm0 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/diary.html&title=diary.html" target="_new">diary.html</a>
</div>
<div class="lm70 tm5 rm60">
JavaScript
</div>
<div class="lm100 tm0 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/diary1.js&title=diary1.js" target="_new">diary1.js</a>　カレンダーとテキスト入力フォーム
</div>
<div class="lm100 tm5 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/diary2.js&title=diary2.js" target="_new">diary2.js</a>　キーワードによる検索フォーム
</div>
<div class="lm70 tm5 rm60">
CSS
</div>
<div class="lm100 tm0 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/diary.css&title=diary.css" target="_new">diary.css</a>
</div>
<div class="lm70 tm10 rm60">
サーバーサイドの処理
</div>
<div class="lm100 tm0 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/sql_r10.txt&title=sql_r10.php" target="_new">sql_r10.php</a>　日記帳テーブルから指定された日付のレコードを読み込む
</div>
<div class="lm100 tm0 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/sql_r20.txt&title=sql_r20.php" target="_new">sql_r20.php</a>　日記帳テーブルから指定された期間に存在するレコードの日付を読み込む
</div>
<div class="lm100 tm5 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/sql_w10.txt&title=sql_w10.php" target="_new">sql_w10.php</a>　日記帳テーブルにデータを書き出す（変更または追加）
</div>
<div class="lm100 tm5 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/sql_w11.txt&title=sql_w11.php" target="_new">sql_w11.php</a>　日記帳テーブルからデータを削除する
</div>
<div class="lm100 tm5 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/sql_r51.txt&title=sql_r51.php" target="_new">sql_r51.php</a>　日記帳テーブルの指定された期間のデータからキーワードにマッチしたデータを読み込む（OR検索）
</div>
<div class="lm100 tm5 rm60">
<a href="/lib/HTMLofText.html?filename=/html/6/source/sql_r52.txt&title=sql_r52.php" target="_new">sql_r52.php</a>　日記帳テーブルの指定された期間のデータからキーワードにマッチしたデータを読み込む（AND検索）
</div>
<h4 class="lm70 tm20 bm0 rm60">
備忘録
</h4>
<div class="lm70 tm0" style="width:580px; border-top:solid 1px #909090;"></div>
<div class="lm70 tm5 rm60">
Visual Studio Code（1.45.1）でソースコードを編集していると、ごく稀に制御コードがまぎれ込み、プログラムが誤動作することがある。どうもバックスペースが怪しい。エディター上では認識しないので、そういう可能性に行き当たったときは別のエディター（mi）でファイルを開いて確認する。
</div>
<div class="bp40"></div><!-- 空白行 -->
<!----------------------------------------------->
</div><!-- end of content -->
<footer id="mainfooter">
<div class="tp10 bm10 bp10 textright"> <span class="rm500 font80"><a href=/lib/index4.html">メニューに戻る</a></span><span class="rm20 font80"><a href="#mainheader">TOPに戻る</a></span></div>
</footer>
<script type="text/javascript" src="/lib/access/access2.js"></script>
</body>
</html>




