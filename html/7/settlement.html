<!-- -->
<DOCTYPE HTML>
<html id="mainhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>一覧表の表示と更新</title>
    <link rel="stylesheet" type="text/css" href="/lib/document.css">
</head>
<body id="mainbody">
<!-- ↓↓↓↓↓↓↓↓↓↓↓ -->
<script type="text/javascript" src="/lib/funcs4.js"></script>
<!-- ↑↑↑↑↑↑↑↑↑↑ -->
<div id="content">
<h2 class="lm70 tm10 bm10 rm60">
一覧表の表示と更新
</h2>
<div class="lm80 tm10 bm10 rm60">
サーバのデータベースから取得したデータを二次元の表に表示する。画面上でデータを編集し、データベースに更新する。
</div>
<div class="lm80 tm10 bm10 rm60">
サンプルのアプリケーションは、とある町内会の会計データを表示したもので、年度毎の収支と繰越し金額の推移を一覧表にしたものである。収入、支出および戸数、人数、コメントは画面から入力可能であり、収支を変更したときは、全体の金額を再計算する。入力の反映はひとまずは画面上だけで、データベースに更新するには、更新ボタンの実行により行う。
</div>
<!-- 画像 -->
<a href="/lib/HTMLofVideo.html?filename=/html/7/settlement.mp4&title=settlement&width=650" target="_new">
<img class="lm100 tm0 bm0" src="settlement.png" alt="[settlement]" width="300"></a>
<div class="lm110 tm5 rm60">
画像をクリックすると動画が表示されます
</div>
<!------ h ------>
<h3 class="lm70 tm20 bm0 rm60">
データの取得と更新
</h3>
<div class="lm70 tm5 bm0 rm60">
データベースからデータを取得し更新するには、<a href='/html/5/health_calendar.html' target="_blank">血圧管理カレンダー</a>、<a href='/html/6/diary.html' target="_blank">日記帳</a>と同様に、HTTPリクエストをサーバに送り、サーバ側のPHPスクリプトでデータベースの操作を行うようにする。レスポンスデータはJSON文字列で受け取る。表は、HTML要素を動的に追加することによって作成する。
</div>
<h3 class="lm70 tm20 bm0 rm60">
input要素のイベントを補足する
</h3>
<div class="lm70 tm5 bm10 rm60">
アプリケーションでは、入力を行う収入、支出、戸数、人数といったデータは input要素に設定する。数値はカンマ編集して表示する。
</div>
<div class="lm70 tm10 bm10 rm60">
操作者が値を入力するために input要素にフォーカスを移したとき、数値にカンマが残っていると編集が煩わしいので、イベントハンドラの働きにより数値のカンマを削除している。
</div>
<div class="lm70 tm10 bm10 rm60">
入力が済み、タブキーによる移動や他の要素をクリックしてフォーカスを抜けたとき、入力値のニューメリックチェックを行い、エラーがあれば入力値を消し、フォーカスを元の場所に戻す。エラーがなければ数値をカンマ編集し、入力が収支の場合は全期間の金額の再計算を行い表を再表示する。
</div>
<div class="lm70 tm10 bm0 rm60">
フォーカスが当たったときは focusイベントが、外れたときは blurイベントが発生する。イベントリスナーによりイベントを監視し、イベントが発生したときに実行する関数を定義する。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/7/event1.txt" width="580" height="200"></iframe>
<div class="lm70 tm20 bm0 rm60">
イベント発生時に行う、数値をカンマ編集する処理。正規表現を利用する。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/7/event2.txt" width="580" height="330"></iframe>
<div class="lm70 tm20 bm0 rm60">
数値のニューメリック（整数）チェック
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/7/event3.txt" width="580" height="130"></iframe>
<h3 class="lm70 tm20 bm0 rm60">
オブジェクト（連想配列）の配列をソートする
</h3>
<div class="lm70 tm5 bm0 rm60">
オブジェクトを要素に持った配列をソートするには、配列のソートメソッド（Array.sort)を実装し、中でオブジェクト同士の大小関係を判定するだけで良い。次のコードはレコードの配列を年をキーにソートしているものである。
</div>
<!--ソースコード-->
<iframe class="lm70 tm5" src="/lib/HTMLofText.html?filename=/html/7/sort.txt" width="580" height="280"></iframe>
<!------ h ------>
<h3 class="lm70 tm30 bm0 rm60">
ソースコード
</h3>
<div class="lm70 tm0" style="width:580px; border-top:solid 1px #909090;"></div>
<!--ソースコード-->
<div class="lm70 tm5 rm60">HTML&nbsp;&nbsp;
<a href="/lib/HTMLofText.html?filename=/data/A23/source/settlement.html&title=diary.html" target="_new">diary.html</a>
</div>
<div class="lm70 tm5 rm60">
JavaScript&nbsp;&nbsp;
<a href="/lib/HTMLofText.html?filename=/html/7/source/settlement.js&title=diary1.js" target="_new">diary1.js</a>
</div>
<div class="lm70 tm5 rm60">
CSS&nbsp;&nbsp;
<a href="/lib/HTMLofText.html?filename=/html/7/source/settlement.css&title=>diary.css" target="_new">diary.css</a>
</div>
<div class="lm70 tm10 rm60">
サーバーサイドの処理
</div>
<div class="lm70 tm0 rm60">
<a href="/lib/HTMLofText.html?filename=/html/7/source/sql_r10.txt&title=sql_r10.php" target="_new">sql_r10.php</a>
</div>
<div class="lm70 tm5 rm60">
<a href="/lib/HTMLofText.html?filename=/html/7/source/sql_w10.txt&title=sql_w10.php" target="_new">sql_w10.php</a>
</div>

<div class="bp40"></div><!-- 空白行 -->
<!----------------------------------------------->
</div><!-- end of content -->
<footer id="mainfooter">
<div class="tp10 bm10 bp10 textright"> <span class="rm500 font80"><a href="/lib/index4.html">メニューに戻る</a></span><span class="rm20 font80"><a href="#mainheader">TOPに戻る</a></span></div>
</footer>
<script type="text/javascript" src="/lib/access/access2.js"></script>
</body>
</html>